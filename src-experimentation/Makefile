
BUILD_DIR := build

CXX       := g++
CPPFLAGS  := -std=c++14 -O3 -Wall -MMD
CPPFLAGS  += -I/usr/local/include/libusb-1.0 
LDFLAGS   := /usr/local/lib/libusb-1.0.a -ludev

# Files
SRCS := $(wildcard *.cpp)
OBJS := $(SRCS:%.cpp=$(BUILD_DIR)/%.o)
OBJ   = $(patsubst %.out,%.o,$@)
EXES := $(OBJS:%.o=%.out)
DEPS      := $(OBJS:$.o=$.d)

# General targets
all: $(EXES)

clean:
	rm -rf $(BUILD_DIR)

# Build each cpp file into an exe
$(EXES): $(BUILD_DIR) $(OBJS)
	$(CXX) $(OBJ) -o $@ $(LDFLAGS)

$(BUILD_DIR)/%.o: %.cpp
	$(CXX) -c $(CPPFLAGS) -o $@ $<

$(BUILD_DIR):
	mkdir -p $@

# include all .d files generated by g++ because of the -MMD flag
-include $(DEPS)

.PHONY: all clean